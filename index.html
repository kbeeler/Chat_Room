<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chat App</title>

  <style>
    body {
      padding: 10;
      margin:10;
      display: flex;
      justify-content: center;
      background-color: lightgray;
    }

    .yourDiv {
    background-color: green;
    color: white;
    align-items: left;
    text-align: left;
    }
    .myDiv {
    background-color: blue;
    color: white;
    }

    </style>
  </head>

<!-- client Side -->
<body>
  <form>
    <input placeholder="typeMsg" type="text" id="m" />
    <input type="submit" id="submitButton" value="submit" />
  </form>
  <ul id="messages"></ul>
</body>

<script src="/socket.io/socket.io.js"></script>
<script
  src="https://code.jquery.com/jquery-3.5.1.js"
  integrity="sha256-QWo7LDvxbWT2tbbQ97B53yJnYU3WhH/C8ycbRAkjPDc="
  crossorigin="anonymous"
></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.26.0/moment.min.js"></script>

<script>
  let userName = prompt("whats your name");
  let room = prompt("room name");
  let ID = "";
  var socket = io();

  //Emitting the ‘join room’ event from the client-side code
  socket.emit("join room", { username: userName, roomName: room });

  socket.on("send data", (data) => {
    ID = data.id;
    console.log(" my ID:" + ID);
  });



  document.getElementById("m").focus();
  //when form is submitted, capture the input value and then send it to server
  document
    .getElementsByTagName("form")[0]
    .addEventListener("submit", function (event) {
      event.preventDefault();
      //here is the emit for what the user types in on the browser.
      socket.emit("chat message", {
        value: document.getElementById("m").value,
        user: userName,
      });
      //clears the msg after you type it
      document.getElementById("m").value = "";
    });

  socket.on("chat message", (data) => {
    console.log("full data returned:", data);
    console.log("data specified:", data.data.user + ": " + data.id);
    displayMessage(data);
  });

  function displayMessage(data) {
    //this is the same data passed in above
    let authorClass = "";
    let divClass = "";
    //verify that the user ID and the message sent ID is similar
    if (data.id === ID) {
      console.log("This person has sent a message");
      authorClass = "me";
      divClass = "myDiv";
    } else {
      authorClass = "you";
      divClass = "yourDiv";
      console.log("that other person send a msg")
    }

    const div = document.createElement("div");
    div.className = divClass;

    const li = document.createElement("li");
    const p = document.createElement("p");

    p.className = "time";
    p.innerText = moment().format("hh:mm");
    
    div.innerHTML =
      '<p class="' + authorClass + '">' + data.data.user + "</p>" +
      '<p class="message"> ' + data.data.value + "</p>";

    div.appendChild(p);
    li.appendChild(div);

    document.getElementById("messages").appendChild(li);
    //scroll to the bottom
    window.scrollTo(0, document.body.scrollHeight);
  }

</script>

</html>